# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤ –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É Pull Request
# –ó–∞–≤–¥–∞–Ω–Ω—è 3 (–°—Ü–µ–Ω–∞—Ä—ñ–π 1): –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

name: PR Tests

on:
  pull_request:
    # –¢—Ä–∏–≥–µ—Ä: –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∞–±–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ Pull Request
    branches: [main, master, develop]
    types: [opened, synchronize, reopened]

# –°–∫–∞—Å—É–≤–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –∑–∞–ø—É—Å–∫–∏ –¥–ª—è —Ç–æ–≥–æ —Å–∞–º–æ–≥–æ PR
concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  pr-checks:
    name: üîç PR Quality Checks
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4

      - name: üì¶ Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: üì¶ Install dependencies (Node.js demo)
        working-directory: nodejs-demo
        run: npm ci

      - name: üß™ Run unit tests
        working-directory: nodejs-demo
        run: npm test

      - name: ‚úÖ All checks passed
        run: echo "‚úÖ –í—Å—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —É—Å–ø—ñ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ñ! PR –≥–æ—Ç–æ–≤–∏–π –¥–æ review."

  # –ö–æ–º–µ–Ω—Ç–∞—Ä –¥–æ PR –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
  comment-result:
    name: üí¨ Comment on PR
    runs-on: ubuntu-latest
    needs: pr-checks
    if: always()

    steps:
      - name: üí¨ Post comment
        uses: actions/github-script@v7
        with:
          script: |
            const status = '${{ needs.pr-checks.result }}' === 'success' ? '‚úÖ' : '‚ùå';
            const message = status === '‚úÖ' 
              ? '**–¢–µ—Å—Ç–∏ –ø—Ä–æ–π—à–ª–∏ —É—Å–ø—ñ—à–Ω–æ!** üéâ\nPR –≥–æ—Ç–æ–≤–∏–π –¥–æ code review.'
              : '**–¢–µ—Å—Ç–∏ –Ω–µ –ø—Ä–æ–π—à–ª–∏** üòû\n–ë—É–¥—å –ª–∞—Å–∫–∞, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ —Ç–∞ –≤–∏–ø—Ä–∞–≤—Ç–µ –ø–æ–º–∏–ª–∫–∏.';

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## ${status} –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è\n\n${message}`
            });
