# Matrix Testing - Ð—Ð°Ð¿ÑƒÑÐº Ð½Ð° ÐºÑ–Ð»ÑŒÐºÐ¾Ñ… ÑÐµÑ€ÐµÐ´Ð¾Ð²Ð¸Ñ‰Ð°Ñ…
# Ð—Ð°Ð²Ð´Ð°Ð½Ð½Ñ 3 (Ð¡Ñ†ÐµÐ½Ð°Ñ€Ñ–Ð¹ 3): Ð¢ÐµÑÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ Ð½Ð° Ñ€Ñ–Ð·Ð½Ð¸Ñ… ÐžÐ¡ Ñ‚Ð° Ð²ÐµÑ€ÑÑ–ÑÑ…

name: Matrix Testing

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  workflow_dispatch: # Ð”Ð¾Ð·Ð²Ð¾Ð»ÑÑ” Ñ€ÑƒÑ‡Ð½Ð¸Ð¹ Ð·Ð°Ð¿ÑƒÑÐº

jobs:
  # Matrix Ð´Ð»Ñ Node.js
  nodejs-matrix:
    name: ðŸ“¦ Node.js ${{ matrix.node-version }} on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}

    strategy:
      # ÐŸÑ€Ð¾Ð´Ð¾Ð²Ð¶ÑƒÐ²Ð°Ñ‚Ð¸ Ñ–Ð½ÑˆÑ– jobs Ð½Ð°Ð²Ñ–Ñ‚ÑŒ ÑÐºÑ‰Ð¾ Ð¾Ð´Ð¸Ð½ Ð¿Ñ€Ð¾Ð²Ð°Ð»Ð¸Ð²ÑÑ
      fail-fast: false
      matrix:
        # Ð Ñ–Ð·Ð½Ñ– Ð¾Ð¿ÐµÑ€Ð°Ñ†Ñ–Ð¹Ð½Ñ– ÑÐ¸ÑÑ‚ÐµÐ¼Ð¸
        os: [ubuntu-latest, windows-latest, macos-latest]
        # Ð Ñ–Ð·Ð½Ñ– Ð²ÐµÑ€ÑÑ–Ñ— Node.js
        node-version: ["18.x", "20.x", "22.x"]
        # Ð’Ð¸ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ Ð¿ÐµÐ²Ð½Ð¸Ñ… ÐºÐ¾Ð¼Ð±Ñ–Ð½Ð°Ñ†Ñ–Ð¹ (Ð¾Ð¿Ñ†Ñ–Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
        exclude:
          - os: macos-latest
            node-version: "18.x"

    defaults:
      run:
        working-directory: nodejs-demo

    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ðŸ“¦ Set up Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}

      - name: ðŸ“¦ Install dependencies
        run: npm install

      - name: ðŸ§ª Run tests
        run: npm test

      - name: âœ… Report success
        run: echo "âœ… Node.js ${{ matrix.node-version }} on ${{ matrix.os }} passed!"

  # Matrix Ð´Ð»Ñ Python
  python-matrix:
    name: ðŸ Python ${{ matrix.python-version }} on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}

    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest]
        python-version: ["3.10", "3.11", "3.12"]

    defaults:
      run:
        working-directory: python-demo

    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ðŸ Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}

      - name: ðŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: ðŸ§ª Run tests
        run: python manage.py test

      - name: âœ… Report success
        run: echo "âœ… Python ${{ matrix.python-version }} on ${{ matrix.os }} passed!"

  # Ð¤Ñ–Ð½Ð°Ð»ÑŒÐ½Ð¸Ð¹ ÑÑ‚Ð°Ñ‚ÑƒÑ
  matrix-complete:
    name: âœ… Matrix Complete
    runs-on: ubuntu-latest
    needs: [nodejs-matrix, python-matrix]
    if: always()

    steps:
      - name: ðŸ“Š Summary
        run: |
          echo "# ðŸ“Š Matrix Testing Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Platform | Result |" >> $GITHUB_STEP_SUMMARY
          echo "|----------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| Node.js Matrix | ${{ needs.nodejs-matrix.result == 'success' && 'âœ…' || 'âŒ' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Python Matrix | ${{ needs.python-matrix.result == 'success' && 'âœ…' || 'âŒ' }} |" >> $GITHUB_STEP_SUMMARY
